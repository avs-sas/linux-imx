// SPDX-License-Identifier: GPL-2.0+
/*
 * Copyright 2023 Avnet Silica
 */

#include "imx8mp-evk.dts"

/ {
	reg_vcc_ext_in: regulator-vcc-ext-in {
		compatible = "regulator-fixed";
		regulator-name = "vcc-ext-in";
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_csi0_pwn>;
		regulator-min-microvolt = <5000000>;
		regulator-max-microvolt = <5000000>;
		gpio = <&gpio2 11 GPIO_ACTIVE_HIGH>;
		enable-active-high;
	};
};

&dewarp {
	status = "okay";
};

&iomuxc {
	pinctrl_csi0_pwn: csi0_pwn_grp {
		fsl,pins = <
			MX8MP_IOMUXC_SD1_STROBE__GPIO2_IO11	0x19
		>;
	};

	pinctrl_i2c2: i2c2grp {
		fsl,pins = <
			MX8MP_IOMUXC_I2C2_SCL__I2C2_SCL		0x400001c3
			MX8MP_IOMUXC_I2C2_SDA__I2C2_SDA		0x400001c3
		>;
	};
};

&i2c2 {
	/delete-node/ov5640_mipi@3c;

	camera0: alvium@3c {
		compatible = "alliedvision,alvium-csi2";
		reg = <0x3c>;
		vcc-ext-in-supply = <&reg_vcc_ext_in>;
		alliedvision,lp2hs-delay-us = <80>;
		status = "okay";

		csi_id = <0>;
		mclk = <24000000>;
		mclk_source = <0>;

		port {
			alvium0_out: endpoint {
				remote-endpoint = <&mipi_csi0_ep>;
				data-lanes = <1 2 3 4>;
				link-frequencies = /bits/ 64 <681250000>;
				clock-lanes = <0>;
			};
		};
	};
};

&i2c3 {
	/delete-node/ov5640_mipi@3c;

	camera1: alvium@3c {
		compatible = "alliedvision,alvium-csi2";
		reg = <0x3c>;
		vcc-ext-in-supply = <&reg_vcc_ext_in>;
		alliedvision,lp2hs-delay-us = <80>;
		status = "okay";

		csi_id = <1>;
		mclk = <24000000>;
		mclk_source = <0>;

		port {
			alvium1_out: endpoint {
				remote-endpoint = <&mipi_csi1_ep>;
				data-lanes = <1 2 3 4>;
				link-frequencies = /bits/ 64 <681250000>;
				clock-lanes = <0>;
			};
		};
	};
};

&isi_0 {
	status = "okay";

	disable_resolution_check;
	dma-coherent;

	cap_device {
		status = "okay";
	};

	m2m_device {
		status = "okay";
	};
};

&isi_1 {
	status = "okay";

	disable_resolution_check;
	dma-coherent;

	cap_device {
		status = "okay";
	};

	m2m_device {
		status = "okay";
	};
};

&isp_0 {
	status = "disabled";
};

&isp_1 {
	status = "disabled";
};

&mipi_csi_0 {
	status = "okay";
	clock-frequency = <681250000>;
	assigned-clock-rates = <500000000>;
	data-lanes = <4>;

	port {
		mipi_csi0_ep: endpoint {
			remote-endpoint = <&alvium0_out>;
			data-lanes = <4>;
			csis-hs-settle = <14>;
			csis-clk-settle = <2>;
			csis-wclk;
		};
	};
};

&mipi_csi_1 {
	clock-frequency = <681250000>;
	assigned-clock-rates = <500000000>;
	status = "okay";
	data-lanes = <4>;

	port@1 {
		mipi_csi1_ep: endpoint {
			remote-endpoint = <&alvium1_out>;
			data-lanes = <4>;
			csis-hs-settle = <14>;
			csis-clk-settle = <2>;
			csis-wclk;
		};
	};
};